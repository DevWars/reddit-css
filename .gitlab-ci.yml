image: node:latest

before_script:
    - "npm install node-sass@4.9.2 snoowrap@1.15.2"

cache:
    paths:
    - node_modules/

publish:
    stage: deploy
    environment:
        name: production
    script:
        - >-
            npx node-sass --output-style compressed --include-path ./ ./main.scss > ./main.css
        - >-
            node -e "new (require('snoowrap'))(${CONFIG}).getSubreddit('DevWars').updateStylesheet({css: require('fs').readFileSync('./main.css', 'utf8').trim(), reason: 'GitHub push'}).then(()=>{process.exit(0);}).catch((err)=>{console.error(err); process.exit(1);});"
